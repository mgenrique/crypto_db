# Crypto Portfolio Tracker v3
# Configuración principal de la aplicación
# ============================================================================

# ============================================================================
# DATABASE
# ============================================================================
database:
  type: sqlite
  path: ./portfolio.db
  timeout: 5
  echo: false
  pool_size: 5
  max_overflow: 10
  # En producción: PostgreSQL

# ============================================================================
# APPLICATION / RUNTIME
# ============================================================================
# Environment for the application lifecycle. Use values like `development`,
# `staging`, or `production`.
app:
  env: development

  # type: postgresql
  # host: localhost
  # port: 5432
  # user: ${DATABASE_USER}
  # password: ${DATABASE_PASSWORD}
  # database: crypto_tracker

# ============================================================================
# LOGGING
# ============================================================================
logging:
  level: INFO
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: ./logs/app.log
  max_bytes: 10485760  # 10MB
  backup_count: 5
  loggers:
    crypto_tracker:
      level: DEBUG
    src.database:
      level: INFO
    src.services:
      level: INFO
    src.api:
      level: DEBUG

# ============================================================================
# API
# ============================================================================
api:
  version: 3.0.0
  title: "Crypto Portfolio Tracker API"
  description: "Advanced cryptocurrency portfolio management and tax tracking"
  docs_url: /docs
  redoc_url: /redoc
  openapi_url: /openapi.json
  cors:
    allow_origins:
      - "http://localhost"
      - "http://localhost:3000"
      - "http://localhost:8000"
      - "http://localhost:8080"
      - "https://localhost"
    allow_credentials: true
    allow_methods: ["*"]
    allow_headers: ["*"]
  trusted_hosts:
    - localhost
    - 127.0.0.1
    - "*.localhost"
    - "*.example.com"

# ============================================================================
# EXCHANGES (Conectores)
# ============================================================================
exchanges:
  binance:
    enabled: true
    base_url: https://api.binance.com
    ws_url: wss://stream.binance.com:9443
    rate_limit: 1200  # Requests per minute
  coinbase:
    enabled: true
    base_url: https://api.coinbase.com
    sandbox_url: https://api-sandbox.coinbase.com
    rate_limit: 10
  kraken:
    enabled: true
    base_url: https://api.kraken.com
    rate_limit: 15
  uniswap:
    enabled: true
    subgraph_url: https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2

# ============================================================================
# TAX CALCULATIONS
# ============================================================================
tax:
  default_method: FIFO
  allowed_methods:
    - FIFO
    - LIFO
    - AVERAGE_COST
  jurisdictions:
    ES:  # España
      name: "España"
      holding_period: 365  # días
      tax_rate: 0.27
    US:  # USA
      name: "United States"
      holding_period: 365
      tax_rate: 0.37
    DE:  # Alemania
      name: "Germany"
      holding_period: 365
      tax_rate: 0.42

# ============================================================================
# PRICE FETCHING
# ============================================================================
price_fetcher:
  primary: coingecko
  fallback:
    - coinmarketcap
    - binance
  cache_ttl: 300  # segundos
  coingecko:
    rate_limit: 10  # requests per minute (free plan)
  coinmarketcap:
    rate_limit: 30

# Mapping from CoinGecko platform slugs to local network names used in
# `config/networks.yaml`. This allows the application to persist `PriceMapping`
# rows using the canonical network keys from the YAML configuration.
platform_aliases:
  polygon-pos: polygon
  binance-smart-chain: bsc
  arbitrum-one: arbitrum
  avalanche: avalanche
  base: base
  ethereum: ethereum
  solana: solana

# ============================================================================
# PORTFOLIO
# ============================================================================
portfolio:
  auto_refresh: true
  refresh_interval: 300  # segundos
  decimal_places: 8
  # Fiat currency used for tax reporting and valuations (ISO 4217)
  fiat_currency: EUR

# ============================================================================
# FEATURES
# ============================================================================
features:
  portfolio_management: true
  tax_calculation: true
  defi_integration: true
  price_tracking: true
  transaction_history: true
  report_generation: true
  performance_analytics: true

# ============================================================================
# SECURITY / AUTH
# ============================================================================
# Optional centralized security settings. Sensitive values should be set in .env
security:
  # Can be overridden via env: SECRET_KEY
  secret_key: ${SECRET_KEY}
  access_token_expire_minutes: ${ACCESS_TOKEN_EXPIRE_MINUTES:-30}
  refresh_token_expire_days: ${REFRESH_TOKEN_EXPIRE_DAYS:-7}

# ============================================================================
# CONNECTORS / PROVIDERS
# ============================================================================
connectors:
  # Provider API keys used by some blockchain connectors (Alchemy/Infura/etc.)
  alchemy_api_key: ${ALCHEMY_API_KEY}
  infura_project_id: ${INFURA_PROJECT_ID}
  infura_project_secret: ${INFURA_PROJECT_SECRET}
  
  # Background sync controls for connectors. When enabled, the app will
  # periodically poll user-registered exchange accounts (balances, trades,
  # deposits, withdrawals) and persist results to the database. For local
  # development and testing you may want to disable this.
  background_sync:
    enabled: true            # Set to false to disable automatic background sync
    interval_seconds: 300    # Polling interval in seconds (default: 300)

# ============================================================================
# INTEGRATIONS
# ============================================================================
integrations:
  # Sentry DSN for error tracking (optional)
  sentry_dsn: ${SENTRY_DSN}

  # Redis / cache backend (optional)
  redis_url: ${REDIS_URL}

  # Email / SMTP settings (optional)
  smtp:
    host: ${SMTP_HOST}
    port: ${SMTP_PORT}
    user: ${SMTP_USER}
    password: ${SMTP_PASSWORD}
